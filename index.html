<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... meta and styles remain same as previous ... -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuickPaste – Instantly Share Text & Media</title>
  <!-- ... all your meta, CSS and script includes ... -->
  <style>
    /* Same styles from previous version (container, buttons, modal, etc) */
    /* ... (copy from previous response) ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- same HTML content as before -->
    <h1><i class="fa-solid fa-paper-plane"></i> QuickPaste</h1>
    <p class="description">Instantly share text, image or video links across devices with just one code.</p>
    <textarea id="input" placeholder="Paste text, image or video link..."></textarea>
    <div class="code-display">Code: <span id="codeValue">-</span></div>
    <div class="qr" id="qrSection" style="display: none;">
      <canvas id="qr"></canvas>
    </div>
    <div class="media-preview" id="mediaPreview"></div>
    <button id="generateBtn">Generate Code</button>
    <div class="timer-section" title="Cooldown timer">
      Cooldown: <span class="timer-display" id="timerDisplay">--:--</span>
      <button id="watchAdBtn" title="Watch an ad to reset cooldown">▶️ Watch Ad to Reset</button>
    </div>
    <div class="ad-block">
      <!-- Your adsense or ad code here -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-XXXXXXX"
           data-ad-slot="SLOT_ID"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    <div class="footer">Free & login-free clipboard. Works on all devices.</div>
  </div>

  <!-- Modal for ad simulation -->
  <div id="adModal" aria-hidden="true" role="dialog" aria-modal="true" tabindex="-1">
    <div id="adContent">
      <p>Watch this ad to reset your cooldown timer.</p>
      <div id="adTimer">15</div>
      <button id="adCloseBtn" disabled>Close Ad</button>
    </div>
  </div>

  <script>
    // Firebase initialization here (same as before)
    const firebaseConfig = {
      apiKey: "AIzaSyDO6gyB_GMN8XOSjzIXfyTtbs4SjYgaAls",
      authDomain: "quickpaste-af1b8.firebaseapp.com",
      projectId: "quickpaste-af1b8",
      storageBucket: "quickpaste-af1b8.appspot.com",
      messagingSenderId: "197671751474",
      appId: "1:197671474:web:01e45e024c2bb47831112b",
      measurementId: "G-YNKFMGH0LE"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.firestore();

    const TIMER_DURATION_MS = 10 * 60 * 1000; // 10 mins cooldown
    const TIMER_STORAGE_KEY = 'quickpasteTimerEnd';
    let timerEnd = localStorage.getItem(TIMER_STORAGE_KEY);
    timerEnd = timerEnd ? parseInt(timerEnd, 10) : 0;

    const timerDisplay = document.getElementById('timerDisplay');
    const watchAdBtn = document.getElementById('watchAdBtn');
    const generateBtn = document.getElementById('generateBtn');
    const adModal = document.getElementById('adModal');
    const adTimerEl = document.getElementById('adTimer');
    const adCloseBtn = document.getElementById('adCloseBtn');

    let timerInterval;
    let timerPaused = false;
    let adInterval;
    let adCountdown = 15; // 15 seconds

    function updateTimerDisplay() {
      if (!timerEnd || timerEnd < Date.now()) {
        timerDisplay.textContent = "00:00";
        generateBtn.disabled = false;
        return false;
      }
      const diff = timerEnd - Date.now();
      if (diff <= 0) {
        timerDisplay.textContent = "00:00";
        generateBtn.disabled = false;
        return false;
      }
      const minutes = Math.floor(diff / 60000);
      const seconds = Math.floor((diff % 60000) / 1000);
      timerDisplay.textContent =
        `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
      generateBtn.disabled = true;
      return true;
    }

    function startTimer() {
      if (!timerEnd || timerEnd < Date.now()) {
        timerEnd = Date.now() + TIMER_DURATION_MS;
        localStorage.setItem(TIMER_STORAGE_KEY, timerEnd);
      }
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (!timerPaused) {
          const active = updateTimerDisplay();
          if (!active) clearInterval(timerInterval);
        }
      }, 1000);
      updateTimerDisplay();
    }

    function openAdModal() {
      adModal.style.display = 'flex';
      adModal.setAttribute('aria-hidden', 'false');
      adCountdown = 15;
      adTimerEl.textContent = adCountdown;
      adCloseBtn.disabled = true;
      adCloseBtn.style.cursor = 'not-allowed';
      adCloseBtn.style.opacity = '0.5';
      timerPaused = true;

      // Start countdown
      adInterval = setInterval(() => {
        adCountdown--;
        adTimerEl.textContent = adCountdown;

        if (adCountdown <= 0) {
          clearInterval(adInterval);
          // Automatically close modal & reset timer after 15s even if no ad loaded
          closeAdModal();
        }
      }, 1000);
    }

    function closeAdModal() {
      adModal.style.display = 'none';
      adModal.setAttribute('aria-hidden', 'true');
      timerPaused = false;
      resetTimer();
    }

    watchAdBtn.addEventListener('click', () => {
      openAdModal();
    });

    adCloseBtn.addEventListener('click', () => {
      if (!adCloseBtn.disabled) closeAdModal();
    });

    function resetTimer() {
      timerEnd = Date.now() + TIMER_DURATION_MS;
      localStorage.setItem(TIMER_STORAGE_KEY, timerEnd);
      startTimer();
    }

    // Paste & code gen logic same as before
    const inputEl = document.getElementById('input');
    const codeValueEl = document.getElementById('codeValue');
    const qrSection = document.getElementById('qrSection');
    const mediaPreview = document.getElementById('mediaPreview');

    function generateCode() {
      const input = inputEl.value.trim();
      if (!input) return alert('Paste something first.');
      if (timerEnd && timerEnd > Date.now()) {
        alert('Please wait for cooldown timer to finish or watch an ad to reset.');
        return;
      }
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      db.collection("pastes").doc(code).set({ content: input, created: Date.now() }).then(() => {
        codeValueEl.textContent = code;
        generateQR(`${location.origin + location.pathname}?code=${code}`);
        showMedia(input);
        resetTimer();
      }).catch(() => alert('Failed to save content, try again.'));
    }

    function generateQR(url) {
      new QRious({
        element: document.getElementById('qr'),
        value: url,
        size: 180,
        background: 'white',
        foreground: '#003366',
        level: 'H'
      });
      qrSection.style.display = 'block';
    }

    function showMedia(content) {
      mediaPreview.innerHTML = '';
      if (content.startsWith('data:image/') || content.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
        mediaPreview.innerHTML = `<img src="${content}" alt="Image preview" />`;
      } else if (content.match(/\.(mp4|webm)$/i)) {
        mediaPreview.innerHTML = `<video controls><source src="${content}" type="video/mp4" /></video>`;
      } else if (content.includes('youtube.com') || content.includes('youtu.be')) {
        const videoId = content.split('v=')[1]?.split('&')[0] || content.split('/').pop();
        mediaPreview.innerHTML = `<iframe width="100%" height="215" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
      } else {
        mediaPreview.innerHTML = `<p>Text content shared.</p>`;
      }
    }

    const params = new URLSearchParams(location.search);
    if (params.has("code")) {
      const code = params.get("code");
      db.collection("pastes").doc(code).get().then(doc => {
        if (doc.exists) {
          const data = doc.data().content;
          inputEl.value = data;
          codeValueEl.textContent = code;
          generateQR(`${location.origin + location.pathname}?code=${code}`);
          showMedia(data);
        } else {
          alert("No content found for that code.");
        }
      });
    }

    startTimer();
    generateBtn.addEventListener('click', generateCode);
  </script>
</body>
</html>
