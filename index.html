<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuickPaste – Instantly Share Text & Media</title>
  <meta name="description" content="QuickPaste lets you instantly paste and share text, images, or video links across devices using a short code. No login required." />
  <meta name="keywords" content="clipboard, quick paste, cross device sharing, QR code text share, free paste tool, copy paste anywhere" />
  <meta name="author" content="V3XES" />
  <meta name="robots" content="index, follow" />
  <meta name="google-site-verification" content="HmrQI75qn05QeBTgDEbJJQKnjqgQcUkUvSIY1UlAgJU" />
  <meta property="og:title" content="QuickPaste" />
  <meta property="og:description" content="Paste and share content across devices with one simple code." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://v3xes.github.io/quickpaste/" />
  <link rel="icon" href="https://v3xes.github.io/quickpaste/favicon.png" type="image/png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXX" crossorigin="anonymous"></script>

  <style>
    /* Styles omitted here for brevity; use the styles from the full version above */
    /* ... */
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fa-solid fa-paper-plane"></i> QuickPaste</h1>
    <p class="description">Instantly share text, image or video links across devices with just one code.</p>

    <textarea id="input" placeholder="Paste text, image or video link..."></textarea>

    <div class="code-display">Code: <span id="codeValue">-</span></div>

    <div class="qr" id="qrSection" style="display: none;">
      <canvas id="qr"></canvas>
    </div>

    <div class="media-preview" id="mediaPreview"></div>

    <button id="generateBtn">Generate Code</button>

    <div class="timer-section" title="Cooldown timer">
      Cooldown: <span class="timer-display" id="timerDisplay">--:--</span>
      <button id="watchAdBtn" title="Watch an ad to reset cooldown">▶️ Watch Ad to Reset</button>
    </div>

    <div class="ad-block">
      <!-- AdSense or other ads here -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-XXXXXXX"
           data-ad-slot="SLOT_ID"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <div class="footer">Free & login-free clipboard. Works on all devices.</div>
  </div>

  <!-- Modal for ad simulation -->
  <div id="adModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.75); z-index:9999; align-items:center; justify-content:center;">
    <div id="adContent" style="background:#fff; border-radius:1.5rem; padding:2rem; max-width:320px; text-align:center; box-shadow:0 12px 36px rgba(0,0,0,0.25); color:#003366; font-size:1.1rem;">
      <p>Watch this ad to reset your cooldown timer.</p>
      <div id="adTimer" style="font-family: 'Courier New', monospace; font-size: 2rem; margin: 1rem 0; color:#1a73e8; font-weight:900;">15</div>
      <button id="adCloseBtn" disabled style="background:#1a73e8; color:#fff; border:none; padding:0.65rem 1.8rem; border-radius:2rem; cursor:not-allowed; font-weight:700; opacity:0.5;">Close Ad</button>
    </div>
  </div>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDO6gyB_GMN8XOSjzIXfyTtbs4SjYgaAls",
      authDomain: "quickpaste-af1b8.firebaseapp.com",
      projectId: "quickpaste-af1b8",
      storageBucket: "quickpaste-af1b8.appspot.com",
      messagingSenderId: "197671751474",
      appId: "1:197671751474:web:01e45e024c2bb47831112b",
      measurementId: "G-YNKFMGH0LE"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.firestore();

    const TIMER_DURATION_MS = 10 * 60 * 1000; // 10 minutes
    const TIMER_STORAGE_KEY = 'quickpasteTimerEnd';
    let timerEnd = localStorage.getItem(TIMER_STORAGE_KEY);
    timerEnd = timerEnd ? parseInt(timerEnd, 10) : 0;

    const timerDisplay = document.getElementById('timerDisplay');
    const watchAdBtn = document.getElementById('watchAdBtn');
    const generateBtn = document.getElementById('generateBtn');

    let timerInterval;
    let timerPaused = false;

    function updateTimerDisplay() {
      if (!timerEnd || timerEnd < Date.now()) {
        timerDisplay.textContent = "00:00";
        generateBtn.disabled = false;
        return false;
      }
      const diff = timerEnd - Date.now();
      if (diff <= 0) {
        timerDisplay.textContent = "00:00";
        generateBtn.disabled = false;
        return false;
      }
      const minutes = Math.floor(diff / 60000);
      const seconds = Math.floor((diff % 60000) / 1000);
      timerDisplay.textContent =
        `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
      generateBtn.disabled = true;
      return true;
    }

    function startTimer() {
      if (!timerEnd || timerEnd < Date.now()) {
        timerEnd = Date.now() + TIMER_DURATION_MS;
        localStorage.setItem(TIMER_STORAGE_KEY, timerEnd);
      }
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (!timerPaused) {
          const active = updateTimerDisplay();
          if (!active) clearInterval(timerInterval);
        }
      }, 1000);
      updateTimerDisplay();
    }

    // Modal controls for fake ad
    const adModal = document.getElementById('adModal');
    const adTimerEl = document.getElementById('adTimer');
    const adCloseBtn = document.getElementById('adCloseBtn');

    let adCountdown = 15; // 15 seconds fake ad
    let adInterval;

    function openAdModal() {
      adModal.style.display = 'flex';
      adCountdown = 15;
      adTimerEl.textContent = adCountdown;
      adCloseBtn.disabled = true;
      adCloseBtn.style.cursor = 'not-allowed';
      adCloseBtn.style.opacity = '0.5';
      timerPaused = true;

      adInterval = setInterval(() => {
        adCountdown--;
        adTimerEl.textContent = adCountdown;
        if (adCountdown <= 0) {
          clearInterval(adInterval);
          adCloseBtn.disabled = false;
          adCloseBtn.style.cursor = 'pointer';
          adCloseBtn.style.opacity = '1';
          adCloseBtn.focus();
        }
      }, 1000);
    }

    function closeAdModal() {
      adModal.style.display = 'none';
      timerPaused = false;
      resetTimer();
    }

    watchAdBtn.addEventListener('click', () => {
      openAdModal();
    });

    adCloseBtn.addEventListener('click', () => {
      if (!adCloseBtn.disabled) closeAdModal();
    });

    // Reset timer to 10 mins from now
    function resetTimer() {
      timerEnd = Date.now() + TIMER_DURATION_MS;
      localStorage.setItem(TIMER_STORAGE_KEY, timerEnd);
      startTimer();
    }

    // Paste & code generation logic
    const inputEl = document.getElementById('input');
    const codeValueEl = document.getElementById('codeValue');
    const qrSection = document.getElementById('qrSection');
    const mediaPreview = document.getElementById('mediaPreview');

    function generateCode() {
      const input = inputEl.value.trim();
      if (!input) return alert('Paste something first.');
      if (timerEnd && timerEnd > Date.now()) {
        alert('Please wait for cooldown timer to finish or watch an ad to reset.');
        return;
      }
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      db.collection("pastes").doc(code).set({ content: input, created: Date.now() }).then(() => {
        codeValueEl.textContent = code;
        generateQR(`${location.origin + location.pathname}?code=${code}`);
        showMedia(input);
        resetTimer();
      }).catch(() => alert('Failed to save content, try again.'));
    }

    function generateQR(url) {
      new QRious({
        element: document.getElementById('qr'),
        value: url,
        size: 180,
        background: 'white',
        foreground: '#003366',
        level: 'H'
      });
      qrSection.style.display = 'block';
    }

    function showMedia(content) {
      mediaPreview.innerHTML = '';
      if (content.startsWith('data:image/') || content.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
        mediaPreview.innerHTML = `<img src="${content}" alt="Image preview" />`;
      } else if (content.match(/\.(mp4|webm)$/i)) {
        mediaPreview.innerHTML = `<video controls><source src="${content}" type="video/mp4" /></video>`;
      } else if (content.includes('youtube.com') || content.includes('youtu.be')) {
        const videoId = content.split('v=')[1]?.split('&')[0] || content.split('/').pop();
        mediaPreview.innerHTML = `<iframe width="100%" height="215" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
      } else {
        mediaPreview.innerHTML = `<p>Text content shared.</p>`;
      }
    }

    // On page load: check URL for code
    const params = new URLSearchParams(location.search);
    if (params.has("code")) {
      const code = params.get("code");
      db.collection("pastes").doc(code).get().then(doc => {
        if (doc.exists) {
          const data = doc.data().content;
          inputEl.value = data;
          codeValueEl.textContent = code;
          generateQR(`${location.origin + location.pathname}?code=${code}`);
          showMedia(data);
        } else {
          alert("No content found for that code.");
        }
      });
    }

    // Initialize timer display on page load
    startTimer();

    // Hook generate button
    generateBtn.addEventListener('click', generateCode);

  </script>
</body>
</html>
